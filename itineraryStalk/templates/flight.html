{% load tags %}

<div class="container border text-center">

    <div class="row border-bottom">
        <div class="col">
            {{ flight.number_in_itinerary }} / {{ itineraries|length }}
        </div>
        <div class="col">
            {{ flight.full_name }}
        </div>
        <div class="col">
            {{ flight.departure_location.name }} -> {{ flight.arrival_location.name }}
        </div>
        <div class="col">
            Status: {{ flight.status|default:"N/A" }}
        </div>
    </div>

    <div class="row">
        <div class="col">
            
        </div>
        <div class="col border-left">
            Scheduled
        </div>
        <div class="col border-left border-right">
            Estimated
        </div>
        <div class="col">
            Actual
        </div>
    </div>

    {% location_datetime_to_server_timezone flight.departure_location flight.scheduled_takeoff as scheduled_takeoff_server %}
    
    {% timestamp_to_aware_datetime flight.actual_takeoff_ts as takeoff %}
    {% timestamp_to_aware_datetime flight.actual_landed_ts as landed %}

    {% server_timezone_string as TIME_ZONE %}

    <div class="row border-top">
        <div class="col">
            Takeoff
        </div>
        
        <div class="col border-left">
            <!--
            <div class="container">
                <div class="row border-bottom">
                    <div class="col">LOCAL</div>
                    <div class="col">{{ flight.scheduled_takeoff }}</div>
                </div>
                <div class="row">
                    <div class="col">{{ TIME_ZONE|upper }} </div>
                    <div class="col">{{ scheduled_takeoff_server }} </div>
                </div>
            </div>
            -->
            <table>
                <tr>
                    <td>LOCAL</td>
                    <td>{{ flight.scheduled_takeoff }}</td>
                </tr>
                <tr>
                    <td>{{ TIME_ZONE|upper }}</td>
                    <td>{{ scheduled_takeoff_server }}</td>
                </tr>
            </table>
        </div>
        
        
        <div class="col border-left border-right">
            -
        </div>
        <div class="col">
            {{ takeoff|default:"N/A yet" }}
        </div>
    </div>

    <div class="row border-top">
        <div class="col">
            Landing
        </div>
        <div class="col border-left">
            {{ flight.scheduled_landing }}
        </div>
        <div class="col border-left border-right">
            {{ flight.readable_eta|default:"N/A yet" }}
        </div>
        <div class="col">
            {{ landed|default:"N/A yet" }}
        </div>
    </div>

    <div class="row border-top">
        <div class="col border-right">
            Last updated: {{ flight.minutes_since_last_update|default:"Never" }}
        </div>
        <div class="col">
            {% if flight.map_link %}
            <a href="{{ flight.map_link }}">Link to live map</a>
            {% else %}
            <p>The link to the live map will be here, once it's available</p>
            {% endif %}
        </div>
    </div>

    {% if flight.eta_landing_ts %}
    <div class="row border-top">
        <div class="col">
            {% include "progress_bar.html" %}
        </div>
    </div>
    {% endif %}


</div>